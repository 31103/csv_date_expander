# テクニカルコンテキスト

## 使用技術

- **言語:** TypeScript
- **ランタイム/ビルドツール:** Deno
- **フロントエンド (Web UI 実行時):**
  - HTML5
  - CSS3 (プレーンCSS、ビルド時にインライン化)
  - JavaScript (ES Modules、TypeScriptからビルド)
  - **標準DOM API (ファイル選択、ドラッグ&ドロップ)**
- **バックエンド/CLI (CLI 実行時):**
  - Deno ランタイム
  - Deno 標準ライブラリ (`std/cli`, `std/io`, `std/fs`, etc.)

## 開発セットアップ

- **必須:** Deno ランタイム (v1.x or v2.x)
  がインストールされている必要があります。
- **開発:**
  - ソースコード (`src/` ディレクトリ内の `.ts` および `.css` ファイル、ルートの
    `cli.ts`) を編集します。
  - Denoの組み込みツール (`deno fmt`, `deno lint`)
    を使用してコードのフォーマットとリントを行います。
  - (将来的に) `deno test` を使用して単体テストを実行します。
- **ビルド (Web UI):** プロジェクトルートで
  `deno run --allow-read --allow-write --allow-net --allow-env build.ts`
  を実行し、`csv_date_expander.html` を生成します。
- **実行 (Web UI):** 生成された `csv_date_expander.html`
  を任意のモダンなWebブラウザで開きます。
- **実行 (CLI):** プロジェクトルートで以下のコマンドを実行します (詳細は
  `README.md` または `--help` を参照)。
  ```bash
  # 標準入出力
  cat input.csv | deno run cli.ts --start-col <列番号> --end-col <列番号> > output.csv

  # ファイル入出力
  deno run --allow-read --allow-write cli.ts --input <入力パス> --start-col <列番号> --end-col <列番号> --output <出力パス> [--limit <上限>] [--verbose]
  ```
  - `<列番号>`: 日付が含まれる列の番号 (1ベース)。
  - `<入力パス>`: (オプション) 処理対象のCSVファイルパス。
  - `<出力パス>`: (オプション) 処理結果を保存するCSVファイルパス。
  - `[--limit <上限>]`: (オプション) 展開する最大行数。デフォルトは365。
  - `[--verbose]`: (オプション) 詳細ログを出力。

## 技術的な制約と考慮事項

- **ブラウザ互換性 (Web UI):**
  ビルドされたHTMLファイルは、主にモダンブラウザ（Chrome, Firefox,
  Edgeなど）を対象としています。古いブラウザでは一部機能が動作しない可能性があります。
- **Deno依存:** 開発、ビルド、およびCLIツールの実行にはDenoが必要です。
- **パフォーマンスとメモリ:**
  - **Web UI:**
    大規模なCSVファイル（数万行以上）を処理する場合、ブラウザのJavaScriptエンジンの性能や利用可能なメモリ量に依存するため、処理速度の低下やメモリ不足が発生する可能性があります。
  - **CLI:**
    Denoランタイム上で実行されるため、一般的にブラウザよりも大きなファイルを扱えますが、それでも極端に巨大なファイルの場合はシステムのメモリ制限に影響される可能性があります。
- **CSV解析の堅牢性:** 実装されているCSVパーサー (`src/csvParser.ts`)
  は基本的なケースに対応します。複雑なエスケープを含むCSVでは問題が発生する可能性があります。(Web
  UI / CLI 共通)
- **日付解析の制限:** "M月D日"
  形式の日付は、ツール実行時の現在の年として解釈されます。年をまたぐ期間を正確に処理するには、入力CSVで
  "YYYY/MM/DD" 形式を使用する必要があります。また、JavaScriptの `Date`
  オブジェクトの解析能力に依存するため、予期しない形式の日付は解析できない場合があります。(Web
  UI / CLI 共通)
- **セキュリティ:**
  - **Web UI:**
    全てクライアントサイドで実行されるため、サーバーサイドでのセキュリティリスクはありませんが、ユーザーは信頼できるソースから取得したCSVファイルのみを処理に使用すべきです。
  - **CLI:**
    ファイルアクセスを行う場合、ファイルシステムへの読み書きアクセス許可
    (`--allow-read`, `--allow-write`) が必要です。実行するスクリプト (`cli.ts`)
    と処理対象のファイルが信頼できるものであることを確認してください。標準入出力のみを使用する場合は、これらの権限は不要です。
- **エンコーディング検出の限界:** 自動検出は UTF-8 (BOMあり/なし) と Shift_JIS
  を対象としていますが、他のエンコーディング（例:
  EUC-JP）には対応していません。また、ファイルの内容によっては誤判定する可能性もゼロではありません。(Web
  UI / CLI 共通)

## 開発規約

- **コミットメッセージ:** コミットメッセージは Conventional Commits
  仕様に従うこと。
